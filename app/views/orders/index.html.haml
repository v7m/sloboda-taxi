= content_for :title, "Orders"
%center  
  %h2
    Orders
.row
  .large-12.small-centered.columns
    %table
      %thead
        %tr
          %th Info  
          %th Order
          %th Client
          %th Driver
          %th Departure
          %th Destination
          %th Cost
          %th Date & Time
          %th Car Type
          %th Status
          - if can? :assign_driver, Order
            %th Assign Driver 
            %th Reject Order
          - elsif can? :confirm, Order 
            %th Confirm Order
            %th Edit Order 
      %tbody
        - @orders.each do |order|
          %tr
            %td 
              = button_to "Show", order_show_path(order), method: :get, class: "button tiny round info"
            %td 
              = order.id
            %td 
              = order.client.firstname
              = order.client.lastname  
            %td 
              - if order.driver
                = order.driver.firstname
                = order.driver.lastname   
            %td 
              = order.departure
            %td 
              = order.destination
            %td 
              = order.cost
            %td 
              = order.datetime
            %td
              = order.car_type.capitalize 
            %td{ id: "order_#{order.id}_status" } 
              = order.status.capitalize

            - if can? :assign_driver, Order   
              - unless order.closed? || order.confirmed?   
                %td  
                  - if order.driver  
                    = button_to "Change Driver", order_edit_driver_path(order), method: :get, class: "button tiny round success"
                  - else  
                    = button_to "Assign Driver", order_edit_driver_path(order), method: :get, class: "button tiny round"
                - unless order.rejected?
                  %td 
                    = button_to "Reject Order", order_reject_path(order), method: :put, class: "button tiny round alert"  

            - elsif can? :confirm, Order 
              %td{ id: "order_#{order.id}_add_driver" }  
                - if order.pending?
                  = button_to "Confirm Order", order_confirm_path(order), method: :put, class: "button tiny round alert", remote: true
                - if order.confirmed?  
                  = button_to "Close Order", order_close_path(order), method: :put, class: "button tiny round success", remote: true
              %td{ id: "order_#{order.id}_edit" }  
                - if order.pending? || order.confirmed?
                  = button_to "Edit Order", order_edit_path(order), method: :get, class: "button tiny round secondary" 